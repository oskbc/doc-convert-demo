name: Convert CSV to Excel (manual)

on:
  workflow_dispatch:
    inputs:
      paths:
        description: "å¤‰æ›ã—ãŸã„CSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ï¼šdocs/src/*.csvï¼‰"
        required: true
        default: "docs/src/**/*.csv"

jobs:
  convert-xlsx:
    runs-on: ubuntu-latest

    steps:
      # --- â‘  ã‚½ãƒ¼ã‚¹ã‚’å–å¾— ---
      - uses: actions/checkout@v4

      # --- â‘¡ Python ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ---
      - name: Pythonã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 python3-pip
          pip3 install pandas openpyxl

      # --- â‘¢ å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ ---
      - name: å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
        run: mkdir -p docs/out

      # --- â‘£ å…¥åŠ›å€¤ã‚’å–å¾— ---
      - name: å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
        id: cfg
        run: echo "paths=${{ github.event.inputs.paths }}" >> $GITHUB_OUTPUT

      # --- â‘¤ CSVã‚’Excelã«å¤‰æ› ---
      - name: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’XLSXã«å¤‰æ›
        env:
          INPUT_PATHS: ${{ steps.cfg.outputs.paths }}
        shell: bash
        run: |
          echo "ğŸ” Searching CSV files in: $INPUT_PATHS"
          FILES=$(bash -lc "ls -1 $INPUT_PATHS 2>/dev/null || true")

          if [ -z "$FILES" ]; then
            echo "âŒ CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
            exit 1
          fi

          echo "=== å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ ==="
          echo "$FILES"

          cat << 'PY' > convert_csv_to_xlsx.py
import pandas as pd
import pathlib

for csv in pathlib.Path("docs/src").rglob("*.csv"):
    try:
        df = pd.read_csv(csv)
        out_path = pathlib.Path("docs/out") / csv.relative_to("docs/src")
        out_path = out_path.with_suffix(".xlsx")
        out_path.parent.mkdir(parents=True, exist_ok=True)
        df.to_excel(out_path, index=False)
        print(f"âœ… Converted: {csv} â†’ {out_path}")
    except Exception as e:
        print(f"âš ï¸ Failed to convert {csv}: {e}")
PY

          python3 convert_csv_to_xlsx.py

      # --- â‘¥ æˆæœç‰©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ---
      - name: æˆæœç‰©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v4
        with:
          name: xlsx-outputs
          path: docs/out/**
